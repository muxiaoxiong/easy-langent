#  ç¬¬å…­ç«  LangGraphåŸºç¡€ï¼šæœ‰çŠ¶æ€å·¥ä½œæµä¸æ ¸å¿ƒæ¦‚å¿µ

## å‰è¨€
å„ä½åŒå­¦ï¼Œä¸Šä¸€ç« æˆ‘ä»¬æŒæ¡äº†LangChainçš„åŸºç¡€å·¥ä½œæµæ„å»ºï¼Œå½“é¢å¯¹æ›´å¤æ‚çš„ä»»åŠ¡â€”â€”æ¯”å¦‚éœ€è¦å¾ªç¯è¿­ä»£ã€åŠ¨æ€åˆ†æ”¯ã€çŠ¶æ€å›æº¯çš„åœºæ™¯æ—¶ï¼ŒLangChainçš„é“¾å¼æµå°±æ˜¾å¾—æœ‰äº›å±€é™äº†ã€‚
è¿™ä¸€ç« æˆ‘ä»¬èšç„¦LangGraphï¼Œå®ƒä½œä¸ºLangChainç”Ÿæ€ä¸­è´Ÿè´£å¤æ‚å·¥ä½œæµç¼–æ’çš„æ ¸å¿ƒæ¡†æ¶ï¼Œ1.0ç‰ˆæœ¬åæ›´æ˜¯å¼ºåŒ–äº†ç”Ÿäº§çº§ç‰¹æ€§ï¼Œèƒ½å¸®æˆ‘ä»¬å®ç°æœ‰çŠ¶æ€ã€å¯è¿½æº¯ã€é«˜çµæ´»åº¦çš„å·¥ä½œæµã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬ä»ç†å¿µåˆ°å®æ“ï¼Œé€æ­¥åƒé€LangGraphã€‚

> LangGraph æ˜¯ LangChain å›¢é˜Ÿåœ¨ 2024 å¹´æ¨å‡ºçš„æ ¸å¿ƒæ¡†æ¶ï¼Œåˆ°äº† 2025 å¹´ï¼Œå®ƒå·²ç»æˆä¸ºæ„å»º Production-Readyï¼ˆç”Ÿäº§çº§ï¼‰Agent çš„è¡Œä¸šæ ‡å‡†ã€‚

å…ˆæå‰å‡†å¤‡ä¾èµ–ï¼ˆç»ˆç«¯æ‰§è¡Œå®‰è£…ï¼‰ï¼š

```python
pip install langgraph
```

> langgraph æ¨èå®‰è£…ç‰ˆæœ¬ â‰¥1.0.0 

## 6.1 LangGraphå›¾ç»“æ„é©±åŠ¨çš„å·¥ä½œæµ

åœ¨æ­£å¼ä¸Šæ‰‹å‰ï¼Œæˆ‘ä»¬å…ˆææ‡‚LangGraphçš„è®¾è®¡åˆè¡·ã€‚å¤§å®¶å¯ä»¥æŠŠå·¥ä½œæµæƒ³è±¡æˆä¸€å¼ â€œä»»åŠ¡åœ°å›¾â€ï¼Œä¼ ç»Ÿé“¾å¼æµæ˜¯â€œå•ä¸€è·¯çº¿â€ï¼Œè€ŒLangGraphçš„å›¾ç»“æ„æ˜¯â€œå¤šèŠ‚ç‚¹ã€å¤šè·¯å¾„â€çš„åœ°å›¾ï¼Œèƒ½åº”å¯¹æ›´å¤æ‚çš„è·¯å†µã€‚

### 6.1.1 ä¸ºä»€ä¹ˆéœ€è¦å›¾ç»“æ„å·¥ä½œæµï¼Ÿ
åœ¨AIåº”ç”¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸é¢ä¸´è¶…è¶Šçº¿æ€§æµç¨‹çš„å¤æ‚ä»»åŠ¡ã€‚æ¯”å¦‚ä¸€ä¸ªæ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œéœ€è¦å…ˆè¯†åˆ«ç”¨æˆ·æ„å›¾ï¼Œå†æ ¹æ®æ„å›¾åˆ†å‘åˆ°æŠ€æœ¯æ”¯æŒã€è®¢å•å’¨è¯¢ç­‰ä¸åŒèŠ‚ç‚¹ï¼Œè‹¥å›ç­”ä¸è¾¾æ ‡è¿˜éœ€å›é€€é‡ç”Ÿæˆâ€”â€”è¿™ç§åŒ…å«åˆ†æ”¯ã€å¾ªç¯çš„åœºæ™¯ï¼Œä¼ ç»Ÿçº¿æ€§é“¾å¼å·¥ä½œæµï¼ˆå¦‚LangChainæ—©æœŸChainï¼‰éš¾ä»¥é«˜æ•ˆæ”¯æ’‘ã€‚

çº¿æ€§æµç¨‹çš„æ ¸å¿ƒç—›ç‚¹æ˜¯â€œåˆšæ€§â€ï¼šä¸€æ—¦å®šä¹‰å¥½æ­¥éª¤é¡ºåºï¼Œéš¾ä»¥åŠ¨æ€è°ƒæ•´ï¼Œä¸”æ— æ³•å¾ˆå¥½åœ°ç®¡ç†è·¨æ­¥éª¤çš„æ•°æ®å…±äº«å’ŒçŠ¶æ€å›æº¯ã€‚è€Œå›¾ç»“æ„å·¥ä½œæµé€šè¿‡â€œèŠ‚ç‚¹â€å°è£…åŠŸèƒ½ã€â€œè¾¹â€å®šä¹‰è·¯å¾„ã€â€œçŠ¶æ€â€å…±äº«æ•°æ®ï¼Œèƒ½ç²¾å‡†è§£å†³è¿™äº›é—®é¢˜ï¼Œè®©å¤æ‚æµç¨‹çš„æ¯ä¸€æ­¥éƒ½å¯æ§åˆ¶ã€å¯è¿½æº¯ã€‚

langGraphé€šè¿‡å¯¹æ™ºèƒ½ä½“å·¥ä½œæµè¿›è¡Œå›¾ç»“æ„å»ºæ¨¡ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒä»·å€¼ï¼š

- **æ˜¾å¼æ§åˆ¶ï¼š**é€šè¿‡æµç¨‹å›¾æ˜ç¡®æŒ‡å®šæ‰§è¡Œè·¯å¾„ï¼Œé¿å…æ™ºèƒ½ä½“åœ¨å¤æ‚ä»»åŠ¡ä¸­"ä¹±è·‘"
- **å¯é¢„æµ‹æ€§ï¼š**ç»“æœæ›´ç¨³å®šï¼Œè¡Œä¸ºæ›´å¯é¢„æµ‹
- **ç²¾ç»†è°ƒæ§ï¼š**æ˜ç¡®è§„å®šä¸‹ä¸€æ­¥èµ°å“ªä¸ªèŠ‚ç‚¹ã€ä½•æ—¶è°ƒç”¨å·¥å…·ã€ä½•æ—¶å¾ªç¯æˆ–ç»ˆæ­¢

![6-1](..\src\img\6-1.png)

### 6.1.2 ä¸LangChainå·¥ä½œæµçš„å·®å¼‚ä¸äº’è¡¥æ€§
å¾ˆå¤šåŒå­¦ä¼šé—®ï¼šæœ‰äº†LangChainï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨LangGraphï¼Ÿå…¶å®ä¸¤è€…ä¸æ˜¯æ›¿ä»£å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥å…³ç³»ï¼ŒLangChainçš„Agentèƒ½åŠ›ç”šè‡³æ˜¯åŸºäºLangGraphè¿è¡Œæ—¶æ„å»ºçš„ã€‚

**å¯¹æ¯”ç»´åº¦ï¼šæµç¨‹çµæ´»æ€§ã€çŠ¶æ€ç®¡ç†ã€å¾ªç¯ä¸åˆ†æ”¯æ”¯æŒ**

| æ ¸å¿ƒç»´åº¦           | LangChain                                                    | LangGraph                                                    |
| :----------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| **æµç¨‹çµæ´»æ€§**     | é‡‡ç”¨é“¾å¼æµè®¾è®¡ï¼Œé€‚ç”¨äºçº¿æ€§ã€å›ºå®šæ­¥éª¤çš„ä»»åŠ¡ï¼›æŠ½è±¡å±‚çº§é«˜ï¼Œé™ä½ä¸Šæ‰‹é—¨æ§›ï¼Œèƒ½å¿«é€Ÿæ­å»ºç®€å•æµç¨‹ã€‚ | åŸºäºå›¾ç»“æ„æµæ„å»ºï¼ŒåŸç”Ÿæ”¯æŒåˆ†æ”¯ã€å¾ªç¯ã€å¹¶è¡Œç­‰å¤æ‚æµç¨‹é€»è¾‘ï¼Œçµæ´»æ€§æå¼ºï¼›éœ€æ‰‹åŠ¨å®šä¹‰èŠ‚ç‚¹åŠèŠ‚ç‚¹é—´çš„è¾¹ï¼Œå¯¹æµç¨‹è®¾è®¡èƒ½åŠ›è¦æ±‚æ›´é«˜ã€‚ |
| **çŠ¶æ€ç®¡ç†**       | çŠ¶æ€åˆ†æ•£å­˜å‚¨äºå„ä¸ªChainç»„ä»¶ä¸­ï¼Œä¸Šä¸‹æ–‡ä¼ é€’éœ€æ‰‹åŠ¨ç¼–ç å®ç°ï¼Œæ— ç»Ÿä¸€ç®¡ç†å…¥å£ï¼Œæ‰©å±•æ€§è¾ƒå¼±ã€‚ | å…·å¤‡ç»Ÿä¸€çŠ¶æ€å¯¹è±¡ï¼Œæ”¯æŒå­—æ®µçº§çŠ¶æ€åˆå¹¶ç­–ç•¥ï¼ˆå¦‚è¿½åŠ ã€è¦†ç›–ç­‰ï¼‰ï¼ŒçŠ¶æ€ç®¡ç†æ›´è§„èŒƒï¼›å†…ç½®çŠ¶æ€æŒä¹…åŒ–èƒ½åŠ›ï¼Œæ— éœ€é¢å¤–å¼€å‘é€‚é…ï¼Œé™ä½è¿ç»´æˆæœ¬ã€‚ |
| **å¾ªç¯ä¸åˆ†æ”¯æ”¯æŒ** | ä»…èƒ½é€šè¿‡æ¡ä»¶åˆ¤æ–­ä»£ç å®ç°ç®€å•åˆ†æ”¯é€»è¾‘ï¼Œå¾ªç¯åŠŸèƒ½éœ€æ‰‹åŠ¨æ§åˆ¶æ‰§è¡Œæ¬¡æ•°ï¼Œéš¾ä»¥é€‚é…å¤æ‚åŠ¨æ€æµç¨‹ã€‚ | é€šè¿‡æ¡ä»¶è¾¹ã€å¾ªç¯è¾¹åŸç”Ÿæ”¯æŒå¤æ‚åˆ†æ”¯ä¸å¾ªç¯é€»è¾‘ï¼Œå¯é…ç½®ç»ˆæ­¢æ¡ä»¶é¿å…æ— é™å¾ªç¯ï¼Œé€‚é…å¤šåœºæ™¯äº¤äº’ã€åŠ¨æ€å†³ç­–ç­‰å¤æ‚ä¸šåŠ¡éœ€æ±‚ã€‚ |

**æ€»ç»“**ï¼š

- LangChainæ›´é€‚åˆå¿«é€Ÿæ­å»ºçº¿æ€§ã€å›ºå®šæµç¨‹çš„è½»é‡åŒ–åº”ç”¨ï¼Œä¸Šæ‰‹æˆæœ¬ä½ï¼Œèƒ½æ»¡è¶³ç®€å•ä»»åŠ¡çš„å¼€å‘éœ€æ±‚ï¼›
- LangGraphåˆ™èšç„¦å¤æ‚æµç¨‹åœºæ™¯ï¼Œå°¤å…¶é€‚ç”¨äºæ™ºèƒ½ä½“å·¥ä½œæµã€åˆè§„å®¡æ ¸å¤šæ­¥éª¤æ ¡éªŒç­‰åœºæ™¯ã€‚

å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·é€‰æ‹©ï¼šå¿«é€Ÿæ­å»ºåŸå‹ã€ä»»åŠ¡æµç¨‹å›ºå®šï¼ˆå¦‚â€œæ–‡æœ¬ç”Ÿæˆâ†’æ ¼å¼è½¬æ¢â€ï¼‰ï¼Œé€‰LangChainé“¾å¼æµï¼Œæ•ˆç‡æ›´é«˜ï¼›ä»»åŠ¡æµç¨‹å¤æ‚ï¼ˆæœ‰åˆ†æ”¯ã€å¾ªç¯ã€å¹¶è¡Œï¼‰ã€éœ€è¦çŠ¶æ€è¿½æº¯ã€è¿½æ±‚ç”Ÿäº§çº§ç¨³å®šæ€§ï¼ˆå¦‚å¤šAgentåä½œã€é•¿æ—¶ä»»åŠ¡ï¼‰ï¼Œé€‰LangGraphå›¾ç»“æ„æµã€‚

## 6.2 LangGraphæ ¸å¿ƒæ¦‚å¿µï¼šå›¾çŠ¶æ€ã€ç‚¹ã€è¾¹
LangGraphçš„æ ¸å¿ƒæ˜¯â€œå›¾ï¼ˆGraphï¼‰â€ï¼Œè€Œæ„æˆå›¾çš„ä¸‰å¤§ç»„ä»¶æ˜¯ï¼šçŠ¶æ€ï¼ˆStateï¼‰ã€èŠ‚ç‚¹ï¼ˆNodesï¼‰ã€è¾¹ï¼ˆEdgesï¼‰ã€‚è¿™ä¸‰è€…å°±åƒä¹é«˜ç§¯æœ¨ï¼Œæ—¢èƒ½æ­ç®€å•çš„çº¿æ€§æµç¨‹ï¼Œä¹Ÿèƒ½æ‹¼å‡ºå¤æ‚çš„åˆ†æ”¯ã€å¾ªç¯å·¥ä½œæµã€‚

> æç¤ºï¼šå…ˆç†è§£â€œç»„ä»¶ä½œç”¨â€ï¼Œå†ç»“åˆä»£ç å®æ“ï¼Œèƒ½å¿«é€Ÿçªç ´æŠ½è±¡å£å’ã€‚

### 6.2.1 çŠ¶æ€ï¼ˆStateï¼‰ï¼šå·¥ä½œæµçš„â€œå…±äº«é»‘æ¿â€
çŠ¶æ€æ˜¯LangGraphå·¥ä½œæµçš„â€œæ•°æ®ä¸­æ¢â€ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„è¾“å…¥ã€è¾“å‡ºéƒ½å›´ç»•å®ƒå±•å¼€ã€‚

é€šä¿—ç±»æ¯”ï¼šæŠŠå·¥ä½œæµæƒ³è±¡æˆç­çº§å¤§æ‰«é™¤ï¼ŒçŠ¶æ€å°±æ˜¯ä¸€å—**å…±äº«é»‘æ¿**â€”â€”æ‰«åœ°çš„åŒå­¦ï¼ˆèŠ‚ç‚¹1ï¼‰æŠŠâ€œåœ°é¢å·²æ¸…æ´â€å†™åœ¨é»‘æ¿ä¸Šï¼Œæ“¦ç»ç’ƒçš„åŒå­¦ï¼ˆèŠ‚ç‚¹2ï¼‰ä»é»‘æ¿çœ‹åˆ°è¿›åº¦åï¼Œå®Œæˆå·¥ä½œå†è¡¥å……â€œç»ç’ƒå·²æ“¦å®Œâ€ï¼Œæ‰€æœ‰èŠ‚ç‚¹åªå’Œé»‘æ¿äº¤äº’ï¼Œä¸ç”¨äº’ç›¸å–Šè¯ã€‚

è¿™ç§è®¾è®¡è®©æ¯ä¸ªæ­¥éª¤çš„ç»“æœéƒ½å¯è¿½æº¯ï¼Œä¹Ÿæ”¯æŒä¸­é€”æš‚åœã€æ¢å¤ï¼ˆæ¯”å¦‚å¤§æ‰«é™¤ä¸­é€”æ”¾å­¦ï¼Œç¬¬äºŒå¤©çœ‹é»‘æ¿å°±çŸ¥é“ä»å“ªç»§ç»­ï¼‰ã€‚

**æ ¸å¿ƒæœ¬è´¨ï¼šå…±äº«æ•°æ®è½½ä½“+çŠ¶æ€å¿«ç…§**

- **å…±äº«æ•°æ®è½½ä½“**ï¼šæ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½è¯»å–ã€ä¿®æ”¹çŠ¶æ€ä¸­çš„æ•°æ®ï¼ˆæ¯”å¦‚å­—æ®µã€åˆ—è¡¨ã€å­—å…¸ï¼‰ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚
- **çŠ¶æ€å¿«ç…§**ï¼šé…åˆå·¥å…·ï¼Œæ¯ä¸€æ­¥çŠ¶æ€å˜åŒ–éƒ½ä¼šè¢«è®°å½•ï¼Œæ”¯æŒå›æº¯å’Œæ–­ç‚¹ç»­è·‘ï¼ˆæ¯”å¦‚é•¿ä»»åŠ¡ä¸­é€”æœåŠ¡å™¨é‡å¯ï¼Œæ¢å¤åä»ä¸Šæ¬¡çŠ¶æ€ç»§ç»­ï¼Œä¸ç”¨é‡åšï¼‰ã€‚

**å®šä¹‰è§„èŒƒï¼šTypedDictç±»å‹å®šä¹‰ä¸å­—æ®µè®¾è®¡åŸåˆ™**

LangGraph 1.0+æ¨èä½¿ç”¨Pythonçš„TypedDict+ Annotatedå®šä¹‰çŠ¶æ€ç»“æ„ï¼Œæ˜ç¡®å­—æ®µç±»å‹å’Œå«ä¹‰ï¼Œæå‡ä»£ç å¯è¯»æ€§å’Œç±»å‹æ ¡éªŒèƒ½åŠ›ã€‚

å­—æ®µè®¾è®¡éœ€éµå¾ªä¸‰ä¸ªåŸåˆ™ï¼š

1. æœ€å°å¿…è¦åŸåˆ™ï¼šåªå®šä¹‰å·¥ä½œæµå¿…éœ€çš„å­—æ®µï¼Œé¿å…å†—ä½™æ•°æ®å ç”¨å†…å­˜ï¼›
2. å¯æ›´æ–°åŸåˆ™ï¼šå°†éœ€è¦è·¨èŠ‚ç‚¹ä¼ é€’ã€ä¿®æ”¹çš„æ•°æ®è®¾ä¸ºçŠ¶æ€å­—æ®µï¼Œå›ºå®šä¸å˜çš„é…ç½®æ— éœ€æ”¾å…¥ï¼›
3. æ¸…æ™°å‘½ååŸåˆ™ï¼šå­—æ®µåéœ€ç›´è§‚åæ˜ æ•°æ®å«ä¹‰ï¼Œå¦‚â€œuser_queryâ€â€œgenerated_textâ€â€œquality_scoreâ€ã€‚

åŸºç¡€å®šä¹‰ç¤ºä¾‹ï¼ˆTypedDictæ–¹å¼ï¼‰ï¼š

```python
from typing import TypedDict, NotRequired

class TaskState(TypedDict):
    user_query: str #ç”¨æˆ·åŸå§‹æŸ¥è¯¢
    tool_result: NotRequired[str] #å·¥å…·è°ƒç”¨ç»“æœ
    final_answer: NotRequired[str] #æœ€ç»ˆå›ç­”
    progress: NotRequired[int] #ä»»åŠ¡è¿›åº¦ç™¾åˆ†æ¯”

#NotRequired è¡¨ç¤ºæ˜¯éå¿…é¡»è¦æ±‚
```

#### 6.2.1.2 çŠ¶æ€ä¼ é€’æœºåˆ¶

LangGraphçš„çŠ¶æ€ä¼ é€’é‡‡ç”¨â€œä¸å¯å˜æ›´æ–°â€åŸåˆ™ï¼šèŠ‚ç‚¹æ¥æ”¶å½“å‰çŠ¶æ€çš„å‰¯æœ¬ï¼Œæ‰§è¡Œé€»è¾‘åè¿”å›æ›´æ–°åçš„éƒ¨åˆ†çŠ¶æ€ï¼ˆæ— éœ€è¿”å›å®Œæ•´çŠ¶æ€ï¼‰ï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨åˆå¹¶ä¸ºæ–°çš„å…¨å±€çŠ¶æ€ï¼Œå†ä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

è¿™ç§æœºåˆ¶çš„ä¼˜åŠ¿æ˜¯é¿å…èŠ‚ç‚¹é—´ç›¸äº’å¹²æ‰°ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªéœ€å…³æ³¨è‡ªå·±éœ€è¦å¤„ç†çš„å­—æ®µã€‚

ä¾‹å¦‚

```python
def parse_query(state: TaskState):
    print("\n====== èŠ‚ç‚¹1 parse_query è¾“å…¥çŠ¶æ€ ======")
    print(state)

    query = state.user_query
    update = {
        "tool_result": f"å·²è§£æé—®é¢˜: {query}",
        "progress": 30
    }

    return update
```

æ˜¯ä¸æ˜¯è¿˜æ˜¯æ„Ÿè§‰å†…å®¹å¾ˆæŠ½è±¡ï¼Œçœ‹ä¸æ‡‚ï¼Œå¤šè¯´æ— ç›Šï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä»£ç æ¡ˆä¾‹æ¥å­¦ä¹ ï¼š

ç°åœ¨æˆ‘ä»¬å‡è®¾ä¸€ä¸ªç®€å•çš„æ™ºèƒ½ä½“å·¥ä½œæµåœºæ™¯ï¼šç”¨æˆ·è¾“å…¥é—®é¢˜ï¼Œç³»ç»Ÿå…ˆè§£æé—®é¢˜ï¼Œå†è°ƒç”¨å¤–éƒ¨å·¥å…·è·å–ä¿¡æ¯ï¼Œæœ€åç”Ÿæˆæœ€ç»ˆå›ç­”ã€‚

æ•´ä¸ªè¿‡ç¨‹éœ€è¦é€šè¿‡ LangGraph çš„è¾¹æ¥å®šä¹‰æ‰§è¡Œé¡ºåºï¼Œä»è€Œå½¢æˆä¸€ä¸ªå¯è‡ªåŠ¨è¿è¡Œçš„ä»»åŠ¡æµæ°´çº¿ã€‚

```python
from typing import TypedDict, NotRequired

class TaskState(TypedDict):
    user_query: str #ç”¨æˆ·åŸå§‹æŸ¥è¯¢
    tool_result: NotRequired[str] #å·¥å…·è°ƒç”¨ç»“æœ
    final_answer: NotRequired[str] #æœ€ç»ˆå›ç­”
    progress: NotRequired[int] #ä»»åŠ¡è¿›åº¦ç™¾åˆ†æ¯”

# ======èŠ‚ç‚¹å‡½æ•°=========
def parse_query(state: TaskState):
    print("\n====== èŠ‚ç‚¹1 parse_query è¾“å…¥çŠ¶æ€ ======")
    print(state)

    query = state["user_query"]
    update = {
        "tool_result": f"å·²è§£æé—®é¢˜: {query}",
        "progress": 30
    }

    print("------ èŠ‚ç‚¹1 æ›´æ–°å­—æ®µ ------")
    print(update)

    return update


def call_tool(state: TaskState):
    print("\n====== èŠ‚ç‚¹2 call_tool è¾“å…¥çŠ¶æ€ ======")
    print(state)

    result = f"å·¥å…·æœç´¢ç»“æœï¼šå…³äºã€{state["user_query"]}ã€çš„ç›¸å…³çŸ¥è¯†"
    update = {
        "tool_result": result,
        "progress": 70
    }

    print("------ èŠ‚ç‚¹2 æ›´æ–°å­—æ®µ ------")
    print(update)

    return update


def generate_answer(state: TaskState):
    print("\n====== èŠ‚ç‚¹3 generate_answer è¾“å…¥çŠ¶æ€ ======")
    print(state)

    answer = f"æœ€ç»ˆå›ç­”ï¼šåŸºäºå·¥å…·ç»“æœ -> {state["tool_result"]}"
    update = {
        "final_answer": answer,
        "progress": 100
    }

    print("------ èŠ‚ç‚¹3 æ›´æ–°å­—æ®µ ------")
    print(update)

    return update

#========æ„å»º LangGraph å·¥ä½œæµ======
from langgraph.graph import StateGraph

# 1. åˆ›å»ºå›¾ï¼ˆç»‘å®šçŠ¶æ€ç±»å‹ï¼‰
builder = StateGraph(TaskState)

# 2. æ·»åŠ èŠ‚ç‚¹
builder.add_node("parse_query", parse_query)
builder.add_node("call_tool", call_tool)
builder.add_node("generate_answer", generate_answer)

# 3. å®šä¹‰æ‰§è¡Œé¡ºåºï¼ˆè¾¹ï¼‰
builder.set_entry_point("parse_query")
builder.add_edge("parse_query", "call_tool")
builder.add_edge("call_tool", "generate_answer")

# 4. ç¼–è¯‘å›¾
graph = builder.compile()

# ====== è¿è¡Œå·¥ä½œæµ ======
init_state = TaskState(user_query="ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ")

final_state = graph.invoke(init_state)

print("\næœ€ç»ˆçŠ¶æ€ï¼š")
print(final_state)
```

è¿è¡Œç»“æœ

```
====== èŠ‚ç‚¹1 parse_query è¾“å…¥çŠ¶æ€ ======
user_query='ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ' tool_result='' final_answer='' progress=0
------ èŠ‚ç‚¹1 æ›´æ–°å­—æ®µ ------
{'tool_result': 'å·²è§£æé—®é¢˜: ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ', 'progress': 30}

====== èŠ‚ç‚¹2 call_tool è¾“å…¥çŠ¶æ€ ======
user_query='ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ' tool_result='å·²è§£æé—®é¢˜: ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ' final_answer='' progress=30
------ èŠ‚ç‚¹2 æ›´æ–°å­—æ®µ ------
{'tool_result': 'å·¥å…·æœç´¢ç»“æœï¼šå…³äºã€ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿã€çš„ç›¸å…³çŸ¥è¯†', 'progress': 70}

====== èŠ‚ç‚¹3 generate_answer è¾“å…¥çŠ¶æ€ ======
user_query='ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ' tool_result='å·¥å…·æœç´¢ç»“æœï¼šå…³äºã€ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿã€çš„ç›¸å…³çŸ¥è¯†' final_answer='' progress=70
------ èŠ‚ç‚¹3 æ›´æ–°å­—æ®µ ------
{'final_answer': 'æœ€ç»ˆå›ç­”ï¼šåŸºäºå·¥å…·ç»“æœ -> å·¥å…·æœç´¢ç»“æœï¼šå…³äºã€ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿã€çš„ç›¸å…³çŸ¥è¯†', 'progress': 100}

æœ€ç»ˆçŠ¶æ€ï¼š
{'user_query': 'ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ', 'tool_result': 'å·¥å…·æœç´¢ç»“æœï¼šå…³äºã€ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿã€çš„ç›¸å…³çŸ¥è¯†', 'final_answer': 'æœ€ç»ˆå›ç­”ï¼šåŸºäºå·¥å…·ç»“æœ -> å·¥å…·æœç´¢ç»“æœï¼šå…³äºã€ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿã€çš„ç›¸å…³çŸ¥è¯†', 'progress': 100}
```

ä»ä¸Šé¢çš„å›¾å°±èƒ½æ¸…æ™°çš„çœ‹åˆ°çŠ¶æ€åœ¨ä¸åŒèŠ‚ç‚¹ç›´æ¥è¿›è¡Œæµè½¬ã€‚

#### 6.2.1.2 çŠ¶æ€ä¼ é€’æœºåˆ¶ï¼šèŠ‚ç‚¹é—´çš„æ•°æ®å…±äº«ä¸æ›´æ–°é€»è¾‘

çŠ¶æ€ä¼ é€’çš„é€»è¾‘å¾ˆç®€å•ï¼šå·¥ä½œæµå¯åŠ¨æ—¶åˆå§‹åŒ–çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œæ—¶æ¥æ”¶å½“å‰çŠ¶æ€ï¼Œå¤„ç†åè¿”å›éœ€è¦æ›´æ–°çš„å­—æ®µï¼ŒLangGraphä¼šæ ¹æ®åˆå¹¶ç­–ç•¥æ›´æ–°å…¨å±€çŠ¶æ€ï¼Œå†ä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

è¿™é‡Œè¦æ³¨æ„ï¼šèŠ‚ç‚¹è¿”å›çš„å­—å…¸åªéœ€åŒ…å«è¦æ›´æ–°çš„å­—æ®µï¼Œæ— éœ€è¿”å›å®Œæ•´çŠ¶æ€ã€‚æ¯”å¦‚èŠ‚ç‚¹åªæ›´æ–°progresså­—æ®µï¼Œå°±è¿”å›{"progress": 1}ï¼ŒLangGraphä¼šè‡ªåŠ¨åˆå¹¶åˆ°å…¨å±€çŠ¶æ€ä¸­ã€‚

**æ€è€ƒï¼š**ä¸ºä»€ä¹ˆèŠ‚ç‚¹è¿”å›çš„å­—å…¸åªéœ€åŒ…å«è¦æ›´æ–°çš„å­—æ®µï¼Œæ— éœ€è¿”å›å®Œæ•´çŠ¶æ€ï¼Ÿ

### 6.2.2 èŠ‚ç‚¹ï¼ˆNodesï¼‰ï¼šå·¥ä½œæµçš„â€œåŠŸèƒ½å°å·¥äººâ€
èŠ‚ç‚¹æ˜¯å·¥ä½œæµçš„â€œæ‰§è¡Œå•å…ƒâ€ï¼Œç›¸å½“äºå›¾ä¸­çš„â€œç«™ç‚¹â€ï¼Œæ¯ä¸ªèŠ‚ç‚¹å°è£…ä¸€æ®µå…·ä½“é€»è¾‘ï¼ˆæ¯”å¦‚è°ƒç”¨LLMã€æŸ¥æ•°æ®åº“ã€å¤„ç†æ•°æ®ï¼‰ï¼Œæœ¬è´¨æ˜¯â€œè¾“å…¥çŠ¶æ€â†’å¤„ç†â†’è¿”å›æ›´æ–°çŠ¶æ€â€çš„çº¯å‡½æ•°ã€‚

é€šä¿—ç±»æ¯”ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªâ€œä¸“ä¸šå°å·¥äººâ€ï¼Œåªåšä¸€ä»¶äº‹â€”â€”ä»å…±äº«é»‘æ¿ï¼ˆçŠ¶æ€ï¼‰æ‹¿ææ–™ï¼Œåšå®ŒåæŠŠç»“æœå†™å›é»‘æ¿ï¼Œä¸ä¾èµ–å¤–éƒ¨æ— å…³ä¿¡æ¯ã€‚

#### 6.2.2.1 æ ¸å¿ƒä½œç”¨ï¼šæ¥æ”¶çŠ¶æ€ã€æ‰§è¡Œé€»è¾‘ã€è¾“å‡ºæ–°çŠ¶æ€

èŠ‚ç‚¹çš„æ ¸å¿ƒä½œç”¨æœ‰ä¸‰ä¸ªï¼šä¸€æ˜¯æ¥æ”¶å…¨å±€çŠ¶æ€ï¼Œæå–æ‰€éœ€å­—æ®µä½œä¸ºè¾“å…¥ï¼›äºŒæ˜¯æ‰§è¡Œå…·ä½“é€»è¾‘ï¼Œæ¯”å¦‚è°ƒç”¨LLMã€å·¥å…·ã€æ•°æ®å¤„ç†ï¼›ä¸‰æ˜¯å°†æ‰§è¡Œç»“æœå°è£…æˆçŠ¶æ€æ›´æ–°å­—å…¸ï¼Œè¿”å›ç»™LangGraphã€‚

éœ€è¦æ³¨æ„ï¼šèŠ‚ç‚¹å¿…é¡»æ˜¯æ— å‰¯ä½œç”¨çš„çº¯å‡½æ•°ï¼Œé€»è¾‘åªä¾èµ–è¾“å…¥çš„çŠ¶æ€ï¼Œä¸ä¾èµ–å¤–éƒ¨å˜é‡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯çŠ¶æ€çš„å¯è¿½æº¯æ€§å’Œå¯å¤ç°æ€§ã€‚

#### 6.2.2.2 èŠ‚ç‚¹ç±»å‹ï¼šLLMè°ƒç”¨èŠ‚ç‚¹ã€å·¥å…·è°ƒç”¨èŠ‚ç‚¹ã€æ•°æ®å¤„ç†èŠ‚ç‚¹

æ ¹æ®åŠŸèƒ½ä¸åŒï¼ŒèŠ‚ç‚¹ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š

LLMè°ƒç”¨èŠ‚ç‚¹ï¼šè´Ÿè´£è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆå†…å®¹ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·æŸ¥è¯¢ç”Ÿæˆå›ç­”ï¼Œæ ¸å¿ƒæ˜¯å°†çŠ¶æ€ä¸­çš„å­—æ®µï¼ˆå¦‚user_queryï¼‰ä¼ å…¥æ¨¡å‹ï¼Œå°†ç”Ÿæˆç»“æœå­˜å…¥çŠ¶æ€ã€‚

å·¥å…·è°ƒç”¨èŠ‚ç‚¹ï¼šè´Ÿè´£è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œæ¯”å¦‚Elasticsearchæ£€ç´¢ã€å¤©æ°”APIæŸ¥è¯¢ï¼Œæ ¸å¿ƒæ˜¯æå–çŠ¶æ€ä¸­çš„å‚æ•°ï¼Œè°ƒç”¨å·¥å…·åå°†ç»“æœæ›´æ–°åˆ°çŠ¶æ€ã€‚

æ•°æ®å¤„ç†èŠ‚ç‚¹ï¼šè´Ÿè´£æ•°æ®è½¬æ¢ã€æ ¡éªŒã€æ ¼å¼å¤„ç†ï¼Œæ¯”å¦‚å°†ç”Ÿæˆçš„å›ç­”æ ¼å¼åŒ–ã€æ ¡éªŒç»“æœæ˜¯å¦åˆæ ¼ï¼Œæ ¸å¿ƒæ˜¯å¯¹çŠ¶æ€ä¸­çš„æ•°æ®è¿›è¡ŒåŠ å·¥ï¼Œè¿”å›å¤„ç†åçš„å€¼ã€‚

ä¸‹é¢ç»“åˆè‡ªå®šä¹‰TaskStateæ¼”ç¤ºï¼š

```python
from typing import TypedDict, NotRequired

class TaskState(TypedDict):
    user_query: str #ç”¨æˆ·åŸå§‹æŸ¥è¯¢
    intent: NotRequired[str] #ç”¨æˆ·æ„å›¾
    llm_answer: NotRequired[str] #LLM ç”Ÿæˆçš„å›ç­”
    tool_result: NotRequired[str] #å·¥å…·è°ƒç”¨ç»“æœ
    final_answer: NotRequired[str] #æœ€ç»ˆå›ç­”
    progress: NotRequired[int] #ä»»åŠ¡è¿›åº¦ç™¾åˆ†æ¯”

#=======LLM è°ƒç”¨èŠ‚ç‚¹ï¼ˆæ¨¡æ‹Ÿï¼‰========= 
#LLM èŠ‚ç‚¹åªè´Ÿè´£â€œç”Ÿæˆæ–‡æœ¬â€ï¼Œä¸è´Ÿè´£å·¥å…·ã€ä¸è´Ÿè´£æ ¼å¼åŒ–ã€‚
def llm_node(state: TaskState):
    print("\nğŸ§  [LLM Node] è¾“å…¥çŠ¶æ€:", state)

    # æ¨¡æ‹Ÿå¤§æ¨¡å‹ç”Ÿæˆ
    llm_output = f"LangGraph æ˜¯ä¸€ç§ç”¨äºæ„å»ºå¯æ§AIå·¥ä½œæµçš„æ¡†æ¶ï¼Œé—®é¢˜æ˜¯ï¼š{state["user_query"]}"

    return {
        "llm_answer": llm_output,
        "progress": 30
    } 

# ====== å·¥å…·è°ƒç”¨èŠ‚ç‚¹ï¼ˆæ¨¡æ‹Ÿæ£€ç´¢ï¼‰ ======
#å·¥å…·èŠ‚ç‚¹åªåš I/Oï¼Œä¸ç”Ÿæˆè¯­è¨€ï¼Œä¸æ§åˆ¶æµç¨‹ã€‚
def tool_node(state: TaskState):
    print("\nğŸ”§ [Tool Node] è¾“å…¥çŠ¶æ€:", state)

    # æ¨¡æ‹Ÿæœç´¢å·¥å…·
    tool_output = f"æ£€ç´¢ç»“æœï¼šLangGraph æ”¯æŒ DAGã€çŠ¶æ€æœºã€Agent workflow"

    return {
        "tool_result": tool_output,
        "progress": 70
    }

# ====== èŠ‚ç‚¹3ï¼šæ•°æ®å¤„ç†èŠ‚ç‚¹ ======
#æ•°æ®èŠ‚ç‚¹è´Ÿè´£åŠ å·¥ stateï¼Œè€Œä¸æ˜¯ç”Ÿæˆæˆ–æ£€ç´¢ã€‚
def data_process_node(state: TaskState):
    print("\nğŸ§¹ [Data Node] è¾“å…¥çŠ¶æ€:", state)

    final = f"""
ã€LLMå›ç­”ã€‘{state["llm_answer"]}
ã€å·¥å…·è¡¥å……ã€‘{state["tool_result"]}
"""

    return {
        "final_answer": final.strip(),
        "progress": 100
    }
    
from langgraph.graph import StateGraph

# 1. åˆ›å»ºå›¾
builder = StateGraph(TaskState)

# 2. æ·»åŠ èŠ‚ç‚¹
builder.add_node("llm_node", llm_node)
builder.add_node("tool_node", tool_node)
builder.add_node("data_process_node", data_process_node)

# 3. å®šä¹‰æµç¨‹
builder.set_entry_point("llm_node")
builder.add_edge("llm_node", "tool_node")
builder.add_edge("tool_node", "data_process_node")

# 4. ç¼–è¯‘
graph = builder.compile()

# åˆå§‹åŒ–çŠ¶æ€
init_state = TaskState(user_query="ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ")

# æ‰§è¡Œ
final_state = graph.invoke(init_state)

print("\n====== æœ€ç»ˆçŠ¶æ€ ======")
print(final_state)

```

è¿è¡Œç»“æœ

```

ğŸ§  [LLM Node] è¾“å…¥çŠ¶æ€: user_query='ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ' llm_answer='' tool_result='' final_answer='' progress=0

ğŸ”§ [Tool Node] è¾“å…¥çŠ¶æ€: user_query='ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ' llm_answer='LangGraph æ˜¯ä¸€ç§ç”¨äºæ„å»ºå¯æ§AIå·¥ä½œæµçš„æ¡†æ¶ï¼Œé—®é¢˜æ˜¯ï¼šä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ' tool_result='' final_answer='' progress=30

ğŸ§¹ [Data Node] è¾“å…¥çŠ¶æ€: user_query='ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ' llm_answer='LangGraph æ˜¯ä¸€ç§ç”¨äºæ„å»ºå¯æ§AIå·¥ä½œæµçš„æ¡†æ¶ï¼Œé—®é¢˜æ˜¯ï¼šä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ' tool_result='æ£€ç´¢ç»“æœï¼šLangGraph æ”¯æŒ DAGã€çŠ¶æ€æœºã€Agent workflow' final_answer='' progress=70

====== æœ€ç»ˆçŠ¶æ€ ======
{'user_query': 'ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ', 'llm_answer': 'LangGraph æ˜¯ä¸€ç§ç”¨äºæ„å»ºå¯æ§AIå·¥ä½œæµçš„æ¡†æ¶ï¼Œé—®é¢˜æ˜¯ï¼šä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ', 'tool_result': 'æ£€ç´¢ç»“æœï¼šLangGraph æ”¯æŒ DAGã€çŠ¶æ€æœº ã€Agent workflow', 'final_answer': 'ã€LLMå›ç­”ã€‘LangGraph æ˜¯ä¸€ç§ç”¨äºæ„å»ºå¯æ§AIå·¥ä½œæµçš„æ¡†æ¶ï¼Œé—®é¢˜æ˜¯ï¼šä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ\nã€å·¥å…·è¡¥å……ã€‘æ£€ç´¢ç»“æœï¼šLangGraph æ”¯æŒ DAGã€çŠ¶æ€æœºã€Agent workflow', 'progress': 100}
```

**ç»“è®ºï¼š**åœ¨ LangGraph ä¸­ï¼Œ**èŠ‚ç‚¹ï¼ˆNodeï¼‰æ˜¯ AI å·¥ä½œæµçš„æœ€å°æ‰§è¡Œå•å…ƒ**ï¼Œè´Ÿè´£å®Œæˆå…·ä½“è®¡ç®—ä»»åŠ¡ï¼Œå¦‚è°ƒç”¨å¤§æ¨¡å‹ã€è°ƒç”¨å¤–éƒ¨å·¥å…·æˆ–è¿›è¡Œæ•°æ®å¤„ç†ã€‚æ¯ä¸ªèŠ‚ç‚¹éµå¾ªâ€œè¯»å–çŠ¶æ€ â†’ æ‰§è¡Œé€»è¾‘ â†’ è¿”å›çŠ¶æ€æ›´æ–°â€çš„å·¥ä½œæ¨¡å¼ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªä»¥çŠ¶æ€ä¸ºè¾“å…¥ã€ä»¥çŠ¶æ€è¡¥ä¸ä¸ºè¾“å‡ºçš„çº¯å‡½æ•°ã€‚

#### 6.2.2.3èŠ‚ç‚¹å®ç°è§„èŒƒï¼šå‡½æ•°å®šä¹‰æ ¼å¼ä¸çŠ¶æ€äº¤äº’æ–¹å¼

LangGraph 1.0+å¯¹èŠ‚ç‚¹å‡½æ•°æœ‰æ˜ç¡®çš„è§„èŒƒè¦æ±‚ï¼Œç¡®ä¿æ¡†æ¶èƒ½æ­£ç¡®è§£æå’Œæ‰§è¡Œï¼š

1. è¾“å…¥å‚æ•°ï¼šå¿…é¡»åŒ…å«çŠ¶æ€å‚æ•°ï¼ˆé€šå¸¸å‘½åä¸ºstateï¼‰ï¼Œç±»å‹éœ€ä¸å®šä¹‰çš„çŠ¶æ€ç»“æ„ä¸€è‡´ï¼ˆå¦‚ConversationStateï¼‰ï¼›å¯é€‰åŒ…å«configå‚æ•°ï¼Œç”¨äºæ¥æ”¶å·¥ä½œæµé…ç½®ã€‚
2. è¾“å‡ºæ ¼å¼ï¼šæ”¯æŒä¸‰ç§å½¢å¼â€”â€”è¿”å›çŠ¶æ€ç‰‡æ®µï¼ˆå­—å…¸æˆ–TypedDictå®ä¾‹ï¼‰ã€è¿”å›Noneï¼ˆæ— çŠ¶æ€æ›´æ–°ï¼‰ã€è¿”å›å¤šä¸ªçŠ¶æ€ç‰‡æ®µï¼ˆé€šè¿‡å…ƒç»„ï¼‰ã€‚
3. äº¤äº’åŸåˆ™ï¼šèŠ‚ç‚¹åªèƒ½é€šè¿‡çŠ¶æ€ä¸å…¶ä»–èŠ‚ç‚¹äº¤äº’ï¼Œç¦æ­¢ç›´æ¥è°ƒç”¨å…¶ä»–èŠ‚ç‚¹å‡½æ•°ï¼Œç¡®ä¿æµç¨‹çš„å¯è¿½æº¯æ€§ã€‚

é”™è¯¯ç¤ºä¾‹ï¼ˆç›´æ¥è°ƒç”¨å…¶ä»–èŠ‚ç‚¹ï¼‰ï¼š

```python

# ä¸æ¨èï¼šèŠ‚ç‚¹é—´ç›´æ¥è°ƒç”¨ï¼Œç ´åæµç¨‹å®Œæ•´æ€§
def bad_node(state: ConversationState):
    answer = generate_answer(state)  # ç›´æ¥è°ƒç”¨å…¶ä»–èŠ‚ç‚¹
    return {"generated_answer": answer}
      
```

### 6.2.3 è¾¹ï¼ˆEdgesï¼‰ï¼šå·¥ä½œæµçš„â€œè·¯å¾„å¯¼èˆªå‘˜â€

è¾¹æ˜¯è¿æ¥èŠ‚ç‚¹çš„â€œè·¯å¾„â€ï¼Œå®šä¹‰äº†èŠ‚ç‚¹é—´çš„è·³è½¬è§„åˆ™ï¼Œå†³å®šäº†å·¥ä½œæµçš„æ‰§è¡Œé¡ºåºã€‚LangGraph 1.0+æ”¯æŒä¸¤ç§æ ¸å¿ƒè¾¹ç±»å‹ï¼šå›ºå®šè¾¹å’Œæ¡ä»¶è¾¹ã€‚

#### 6.2.3.1 æ ¸å¿ƒä½œç”¨ï¼šå®šä¹‰èŠ‚ç‚¹é—´çš„è·³è½¬è§„åˆ™

è¾¹çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯â€œå¯¼èˆªâ€ï¼Œå‘Šè¯‰å·¥ä½œæµâ€œå½“å‰èŠ‚ç‚¹æ‰§è¡Œå®Œåï¼Œä¸‹ä¸€æ­¥è¯¥å»å“ªä¸ªèŠ‚ç‚¹â€ã€‚æ²¡æœ‰è¾¹çš„è¿æ¥ï¼ŒèŠ‚ç‚¹å°±æ˜¯å­¤ç«‹çš„ï¼Œæ— æ³•å½¢æˆå®Œæ•´å·¥ä½œæµã€‚ç®€å•æ¥è¯´ï¼Œè¾¹å°±æ˜¯å·¥ä½œæµçš„â€œæ‰§è¡Œè·¯çº¿å›¾â€ã€‚

#### 6.2.3.2 æ ¸å¿ƒè¾¹ç±»å‹ä¸å®è·µ

å›ºå®šè¾¹æ˜¯æœ€ç®€å•çš„è¾¹ç±»å‹ï¼ŒæŒ‡å®šâ€œä»AèŠ‚ç‚¹åˆ°BèŠ‚ç‚¹â€çš„å›ºå®šè·³è½¬ï¼Œæ— è®ºçŠ¶æ€å¦‚ä½•å˜åŒ–ï¼Œæ‰§è¡Œå®ŒAåå¿…ç„¶æ‰§è¡ŒBï¼Œé€‚åˆçº¿æ€§æµç¨‹ã€‚

æ¡ä»¶è¾¹æ˜¯åŠ¨æ€è¾¹ï¼Œæ ¹æ®å½“å‰çŠ¶æ€åˆ¤æ–­è·³è½¬æ–¹å‘ï¼Œæ”¯æŒå¤šåˆ†æ”¯è·³è½¬ï¼Œé€‚åˆéœ€è¦åŠ¨æ€å†³ç­–çš„åœºæ™¯ã€‚æ¯”å¦‚æ ¹æ®ç”¨æˆ·éœ€æ±‚æ„å›¾ï¼Œåˆ¤æ–­æ˜¯èµ°â€œæ€»ç»“â€åˆ†æ”¯è¿˜æ˜¯â€œæ”¹å†™â€åˆ†æ”¯ã€‚

æ­¤å¤–ï¼ŒLangGraphè¿˜æ”¯æŒå¾ªç¯è¾¹ï¼Œæœ¬è´¨æ˜¯æ¡ä»¶è¾¹çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œé€šè¿‡åˆ¤æ–­çŠ¶æ€æ˜¯å¦æ»¡è¶³ç»ˆæ­¢æ¡ä»¶ï¼Œå†³å®šæ˜¯å›æº¯åˆ°å‰åºèŠ‚ç‚¹ç»§ç»­æ‰§è¡Œï¼Œè¿˜æ˜¯è¿›å…¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚

**å›ºå®šè¾¹**ï¼ˆFixed Edgesï¼‰ï¼šèŠ‚ç‚¹æ‰§è¡Œå®Œæˆåï¼Œå›ºå®šè·³è½¬åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé€‚ç”¨äºçº¿æ€§æµç¨‹ã€‚é€šè¿‡add_edge()æ–¹æ³•é…ç½®ï¼Œå‚æ•°ä¸ºâ€œèµ·å§‹èŠ‚ç‚¹åâ€å’Œâ€œç›®æ ‡èŠ‚ç‚¹åâ€ã€‚

```python
from typing import TypedDict, NotRequired

# ====== å…¨å±€å…±äº«çŠ¶æ€ï¼ˆé»‘æ¿ï¼‰ ======
class TaskState(TypedDict):
    user_query: str #ç”¨æˆ·åŸå§‹æŸ¥è¯¢
    intent: NotRequired[str] #ç”¨æˆ·æ„å›¾
    llm_answer: NotRequired[str] #LLM ç”Ÿæˆçš„å›ç­”
    tool_result: NotRequired[str] #å·¥å…·è°ƒç”¨ç»“æœ
    final_answer: NotRequired[str] #æœ€ç»ˆå›ç­”
    progress: NotRequired[int] #ä»»åŠ¡è¿›åº¦ç™¾åˆ†æ¯”
    
    
#========å›ºå®šè¾¹ï¼ˆçº¿æ€§æµç¨‹ï¼‰å®è·µä»£ç ======
def parse_intent(state: TaskState):
    print("\nğŸ”¹ parse_intent")
    # ç®€å•æ¨¡æ‹Ÿæ„å›¾è¯†åˆ«
    intent = "summarize" if "æ€»ç»“" in state["user_query"] else "rewrite"
    return {"intent": intent, "progress": 30}


def summarize_node(state: TaskState):
    print("\nğŸ”¹ summarize_node")
    return {"llm_answer": f"æ€»ç»“ç»“æœ: {state["user_query"]}", "progress": 60}


def rewrite_node(state: TaskState):
    print("\nğŸ”¹ rewrite_node")
    return {"llm_answer": f"æ”¹å†™ç»“æœ: {state["user_query"]}", "progress": 60}


def final_node(state: TaskState):
    print("\nğŸ”¹ final_node")
    return {"progress": 100}

from langgraph.graph import StateGraph

builder = StateGraph(TaskState)

builder.add_node("parse_intent", parse_intent)
builder.add_node("summarize_node", summarize_node)
builder.add_node("rewrite_node", rewrite_node)
builder.add_node("final_node", final_node)

# å›ºå®šè¾¹ï¼ˆçº¿æ€§ï¼‰
builder.set_entry_point("parse_intent")
builder.add_edge("parse_intent", "summarize_node")   # å›ºå®šèµ°æ€»ç»“
builder.add_edge("summarize_node", "final_node")

graph = builder.compile()

state = TaskState(user_query="è¯·å¸®æˆ‘æ€»ç»“è¿™æ®µè¯")
print(graph.invoke(state))
```

è¿è¡Œç»“æœ

```

ğŸ”¹ parse_intent

ğŸ”¹ summarize_node

ğŸ”¹ final_node
{'user_query': 'è¯·å¸®æˆ‘æ€»ç»“è¿™æ®µè¯', 'intent': 'summarize', 'result': 'æ€»ç»“ç»“æœ: è¯·å¸®æˆ‘æ€»ç»“è¿™æ®µè¯', 'progress': 100}
```

ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹å›¾çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆ**åœ¨ipynbä»£ç é‡Œæ‰§è¡Œ**ï¼‰

```python
from IPython.display import Image, display
display(Image(graph.get_graph().draw_mermaid_png()))
```

![6-2](..\src\img\6-2.png)

ä»å›¾ä¸­èƒ½æ¸…æ¥šçœ‹åˆ°èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€ï¼Œå¯ä»¥ä»å›¾ä¸­çœ‹åˆ°æˆ‘ä»¬å°†rewrite_node å¢åŠ åˆ°äº†èŠ‚ç‚¹ ä½†æ˜¯æ²¡æœ‰ç”¨è¾¹è¿æ¥èµ·æ¥ï¼Œäºæ˜¯rewrite_nodeå˜æˆäº†å­¤ç«‹çš„èŠ‚ç‚¹~

**å­¦ä¹ å®è·µï¼š**å°†rewrite_node ä½¿ç”¨è¾¹è¿æ¥èµ·æ¥ï¼Œæ¯”è¾ƒæœ€åç”Ÿæˆçš„å›¾

**æ¡ä»¶è¾¹**ï¼šæ ¹æ®å½“å‰çŠ¶æ€åŠ¨æ€å†³å®šè·³è½¬è·¯å¾„ï¼Œé€‚ç”¨äºåˆ†æ”¯æµç¨‹ã€‚é€šè¿‡add_conditional_edges()æ–¹æ³•é…ç½®ï¼Œéœ€æŒ‡å®šâ€œèµ·å§‹èŠ‚ç‚¹åâ€â€œæ¡ä»¶åˆ¤æ–­å‡½æ•°â€å’Œâ€œè·¯å¾„æ˜ å°„è¡¨â€

```python
def route_by_intent(state: TaskState):
    if state.intent == "summarize":
        return "summarize_node"
    else:
        return "rewrite_node"


builder = StateGraph(TaskState)

builder.add_node("parse_intent", parse_intent)
builder.add_node("summarize_node", summarize_node)
builder.add_node("rewrite_node", rewrite_node)
builder.add_node("final_node", final_node)

builder.set_entry_point("parse_intent")

# æ¡ä»¶è¾¹
builder.add_conditional_edges(
    "parse_intent",
    route_by_intent,
    {
        "summarize_node": "summarize_node",
        "rewrite_node": "rewrite_node",
    }
)

builder.add_edge("summarize_node", "final_node")
builder.add_edge("rewrite_node", "final_node")

graph = builder.compile()


print("\n====== æµ‹è¯•æ€»ç»“ ======")
print(graph.invoke(TaskState(user_query="è¯·æ€»ç»“è¿™æ®µè¯")))

print("\n====== æµ‹è¯•æ”¹å†™ ======")
print(graph.invoke(TaskState(user_query="è¯·æ”¹å†™è¿™æ®µè¯")))

```

è¿è¡Œç»“æœ

```
====== æµ‹è¯•æ€»ç»“ ======

ğŸ”¹ parse_intent

ğŸ”¹ summarize_node

ğŸ”¹ final_node
{'user_query': 'è¯·æ€»ç»“è¿™æ®µè¯', 'intent': 'summarize', 'result': 'æ€»ç»“ç»“æœ: è¯·æ€»ç»“è¿™æ®µè¯', 'progress': 100}

====== æµ‹è¯•æ”¹å†™ ======

ğŸ”¹ parse_intent

ğŸ”¹ rewrite_node

ğŸ”¹ final_node
{'user_query': 'è¯·æ”¹å†™è¿™æ®µè¯', 'intent': 'rewrite', 'result': 'æ”¹å†™ç»“æœ: è¯·æ”¹å†™è¿™æ®µè¯', 'progress': 100}
```

ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹å›¾çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆ**åœ¨ipynbä»£ç é‡Œæ‰§è¡Œ**ï¼‰

```
from IPython.display import Image, display
display(Image(graph.get_graph().draw_mermaid_png()))
```

![6-3](..\src\img\6-3.png)

**å¾ªç¯è¾¹**

```python
#=======å¾ªç¯èŠ‚ç‚¹======
def loop_node(state: TaskState):
    print("\nğŸ”„ loop_node, progress =", state.progress)
    return {"progress": state.progress + 30}

#=======å¾ªç¯æ¡ä»¶å‡½æ•°======
def loop_router(state: TaskState):
    if state.progress >= 100:
        return "final_node"
    return "loop_node"

#=======æ„å»ºå›¾=========
builder = StateGraph(TaskState)

builder.add_node("loop_node", loop_node)
builder.add_node("final_node", final_node)

builder.set_entry_point("loop_node")

builder.add_conditional_edges(
    "loop_node",
    loop_router,
    {
        "loop_node": "loop_node",     # å›ç¯
        "final_node": "final_node"    # ç»ˆæ­¢
    }
)

graph = builder.compile()

print(graph.invoke(TaskState(user_query="test")))

```

è¿è¡Œç»“æœ

```
ğŸ”„ loop_node, progress = 0

ğŸ”„ loop_node, progress = 30

ğŸ”„ loop_node, progress = 60

ğŸ”„ loop_node, progress = 90

ğŸ”¹ final_node
{'user_query': 'test', 'intent': '', 'result': '', 'progress': 100}
```

ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹å›¾çš„æ‰§è¡ŒçŠ¶æ€ï¼ˆ**åœ¨ipynbä»£ç é‡Œæ‰§è¡Œ**ï¼‰

```
from IPython.display import Image, display
display(Image(graph.get_graph().draw_mermaid_png()))
```

![6-4](..\src\img\6-4.png)

å¾ªç¯è¾¹æœ¬è´¨æ˜¯â€œè¿”å›å‰åºèŠ‚ç‚¹â€çš„æ¡ä»¶è¾¹ï¼Œç”¨äºéœ€è¦é‡å¤æ‰§è¡Œçš„åœºæ™¯ï¼ˆæ¯”å¦‚æ ¡éªŒç»“æœä¸åˆæ ¼ï¼Œé‡æ–°è°ƒç”¨å·¥å…·ï¼‰

### 6.2.4æ€»ç»“

- çŠ¶æ€ï¼ˆStateï¼‰ï¼šå­˜æ•°æ®ã€åšå…±äº«ï¼Œæ˜¯å·¥ä½œæµçš„â€œä¸­æ¢â€ï¼Œç”¨Pydanticå®šä¹‰æ›´æ¸…æ™°ã€‚
- èŠ‚ç‚¹ï¼ˆNodesï¼‰ï¼šåšæ‰§è¡Œã€å¤„ç†é€»è¾‘ï¼Œæ˜¯â€œåŠŸèƒ½å•å…ƒâ€ï¼Œå¿…é¡»æ˜¯çº¯å‡½æ•°ã€‚
- è¾¹ï¼ˆEdgesï¼‰ï¼šå®šè·¯çº¿ã€æ§é¡ºåºï¼Œåˆ†å›ºå®šè¾¹ï¼ˆçº¿æ€§ï¼‰å’Œæ¡ä»¶è¾¹ï¼ˆåˆ†æ”¯/å¾ªç¯ï¼‰ã€‚

ä¸‰è€…ç»„åˆçš„æ ¸å¿ƒé€»è¾‘ï¼šçŠ¶æ€è´¯ç©¿å…¨ç¨‹ï¼ŒèŠ‚ç‚¹å¤„ç†é€»è¾‘ï¼Œè¾¹æ§åˆ¶æµå‘ï¼Œè¿™ä¹Ÿæ˜¯LangGraphèƒ½å®ç°å¤æ‚å·¥ä½œæµçš„æ ¹æœ¬ã€‚

## 6.3 LangGraphè¿è¡Œæœºåˆ¶ï¼šåŸºäºè¶…æ­¥éª¤çš„æ¶ˆæ¯ä¼ é€’

äº†è§£äº†ä¸‰å¤§ç»„ä»¶åï¼Œæˆ‘ä»¬å†æ¥çœ‹LangGraphçš„è¿è¡Œæœºåˆ¶ã€‚LangGraphé‡‡ç”¨â€œè¶…æ­¥éª¤ï¼ˆsuper-stepï¼‰â€æœºåˆ¶ç®¡ç†æ‰§è¡Œæµç¨‹ï¼Œç¡®ä¿èŠ‚ç‚¹æ‰§è¡Œçš„æœ‰åºæ€§å’ŒçŠ¶æ€çš„ä¸€è‡´æ€§ã€‚

LangGraph å·¥ä½œæµæ˜¯å¦‚ä½•â€œè·‘èµ·æ¥â€çš„ï¼Ÿ

LangGraph çš„å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºï¼šğŸ‘‰ **çŠ¶æ€é©±åŠ¨çš„ä»»åŠ¡è°ƒåº¦å¼•æ“**ã€‚

å®ƒä¸æ˜¯ç®€å•åœ°æŒ‰é¡ºåºè°ƒç”¨å‡½æ•°ï¼Œè€Œæ˜¯åƒä¸€ä¸ªæ™ºèƒ½è°ƒåº¦å™¨ï¼Œæ ¹æ®çŠ¶æ€å’Œè¾¹è§„åˆ™åŠ¨æ€å†³å®šâ€œè°è¯¥æ‰§è¡Œâ€ã€‚

### 6.3.1 è¶…æ­¥éª¤ï¼ˆSuper-stepï¼‰ä¸èŠ‚ç‚¹æ´»è·ƒçŠ¶æ€

è¶…æ­¥éª¤æ˜¯LangGraphæ‰§è¡Œå·¥ä½œæµçš„åŸºæœ¬å•ä½ï¼Œå¯ç†è§£ä¸ºâ€œä¸€è½®å¹¶è¡Œä»»åŠ¡æ‰§è¡Œå‘¨æœŸâ€ã€‚æ¯ä¸ªè¶…æ­¥éª¤å†…ï¼Œæ¡†æ¶ä¼šå®Œæˆä¸‰ä»¶äº‹ï¼š

1. æ¿€æ´»èŠ‚ç‚¹ï¼šæ‰€æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼ˆçŠ¶æ€æ›´æ–°ï¼‰çš„èŠ‚ç‚¹ä¼šä»â€œä¼‘çœ çŠ¶æ€â€å˜ä¸ºâ€œæ´»è·ƒçŠ¶æ€â€ï¼›
2. æ‰§è¡ŒèŠ‚ç‚¹ï¼šæ‰€æœ‰æ´»è·ƒèŠ‚ç‚¹å¹¶è¡Œæ‰§è¡Œé€»è¾‘ï¼Œç”Ÿæˆæ–°çš„çŠ¶æ€ç‰‡æ®µï¼›
3. ä¼ é€’æ¶ˆæ¯ï¼šå°†æ–°çš„çŠ¶æ€ç‰‡æ®µä½œä¸ºæ¶ˆæ¯ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶èŠ‚ç‚¹å›å½’ä¼‘çœ çŠ¶æ€ã€‚

è¿™ç§æœºåˆ¶è®©LangGraphå¤©ç„¶æ”¯æŒå¹¶è¡Œæ‰§è¡Œâ€”â€”åŒä¸€è¶…æ­¥éª¤å†…çš„æ´»è·ƒèŠ‚ç‚¹å¯åŒæ—¶è¿è¡Œï¼Œæå‡æµç¨‹æ•ˆç‡ï¼›åŒæ—¶é€šè¿‡æ¶ˆæ¯ä¼ é€’å®ç°èŠ‚ç‚¹é—´çš„ååŒï¼Œç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§ã€‚

âš™ï¸ èŠ‚ç‚¹æ´»è·ƒçŠ¶æ€ï¼šè°åœ¨è¿™ä¸€è½®è¢«è°ƒåº¦ï¼Ÿ

åœ¨æŸä¸ªè¶…æ­¥éª¤ä¸­ï¼š

- å¯èƒ½åªæ¿€æ´»ä¸€ä¸ªèŠ‚ç‚¹
- ä¹Ÿå¯èƒ½åŒæ—¶æ¿€æ´»å¤šä¸ªèŠ‚ç‚¹

ğŸ‘‰ è¿™äº›è¢«æ¿€æ´»çš„èŠ‚ç‚¹å« **æ´»è·ƒèŠ‚ç‚¹ï¼ˆActive Nodesï¼‰**ï¼Œ **ç±»æ¯”**ğŸ‘‰åƒå¤šåå·¥äººåŒæ—¶åœ¨æµæ°´çº¿ä¸Šå·¥ä½œã€‚

### 6.3.2 LangGraph å·¥ä½œæµæ‰§è¡Œå…¨è¿‡ç¨‹

ä¸€ä¸ªå®Œæ•´çš„LangGraphå·¥ä½œæµæ‰§è¡Œæµç¨‹å¯åˆ†ä¸ºå…­ä¸ªé˜¶æ®µï¼š

1.å¯åŠ¨ï¼šè°ƒç”¨graph.invoke()æ–¹æ³•ä¼ å…¥åˆå§‹çŠ¶æ€ï¼Œæ¡†æ¶å°†åˆå§‹çŠ¶æ€ä½œä¸ºæ¶ˆæ¯ï¼Œå‘é€ç»™å…¥å£èŠ‚ç‚¹ï¼Œå…¥å£èŠ‚ç‚¹è¢«æ¿€æ´»ï¼Œè¿›å…¥ç¬¬ä¸€ä¸ªè¶…æ­¥éª¤ã€‚

```
ç”¨æˆ·è¾“å…¥ï¼š{"user_query": "ä»€ä¹ˆæ˜¯ LangGraphï¼Ÿ"}
ç³»ç»Ÿåˆ›å»º åˆå§‹çŠ¶æ€é»‘æ¿ï¼Œå¹¶æ¿€æ´»èµ·å§‹èŠ‚ç‚¹ã€‚
```

2.èŠ‚ç‚¹æ¿€æ´»ï¼šå…¥å£èŠ‚ç‚¹æ¥æ”¶æ¶ˆæ¯åå˜ä¸ºæ´»è·ƒçŠ¶æ€ï¼Œå…¶ä»–èŠ‚ç‚¹ä¿æŒä¼‘çœ ã€‚

```
LangGraph æŸ¥çœ‹ Graphï¼š
parse â†’ tool â†’ generate
å†³å®šå½“å‰åº”æ‰§è¡Œçš„èŠ‚ç‚¹é›†åˆï¼Œä¾‹å¦‚ï¼š
å½“å‰æ¿€æ´»èŠ‚ç‚¹ = [parse]
```

3.é€»è¾‘æ‰§è¡Œï¼šæ´»è·ƒèŠ‚ç‚¹æ‰§è¡Œè‡ªèº«é€»è¾‘ï¼Œè¯»å–åˆå§‹çŠ¶æ€ï¼Œç”Ÿæˆæ›´æ–°åçš„çŠ¶æ€ç‰‡æ®µã€‚

```
æ¯ä¸ªæ´»è·ƒèŠ‚ç‚¹ï¼š
è¯»å–çŠ¶æ€
æ‰§è¡Œé€»è¾‘
è¿”å›çŠ¶æ€æ›´æ–°
ä¾‹å¦‚ï¼š{"tool_result": "..."}
```

4.çŠ¶æ€ä¼ é€’ï¼šæ¡†æ¶åˆå¹¶çŠ¶æ€ç‰‡æ®µä¸ºæ–°çš„å…¨å±€çŠ¶æ€ï¼Œæ ¹æ®è¾¹çš„è§„åˆ™ï¼Œå°†æ–°çŠ¶æ€ä½œä¸ºæ¶ˆæ¯ä¼ é€’ç»™ä¸‹ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰èŠ‚ç‚¹ï¼Œæ¿€æ´»å¯¹åº”èŠ‚ç‚¹ã€‚

```
LangGraph è‡ªåŠ¨æ‰§è¡Œï¼š
state = merge(old_state, node_return)
æ›´æ–°åçš„çŠ¶æ€ä¼šä¼ é€’ç»™ä¸‹ä¸€çº§èŠ‚ç‚¹ã€‚
```

5.åœæ­¢åˆ¤æ–­ï¼šæ˜¯å¦ç»§ç»­æ‰§è¡Œï¼Ÿ

```
ç³»ç»Ÿåˆ¤æ–­ï¼š
æ˜¯å¦è¿˜æœ‰åç»­èŠ‚ç‚¹
æ˜¯å¦è§¦å‘ END
æ˜¯å¦æ»¡è¶³å¾ªç¯ç»ˆæ­¢æ¡ä»¶
```

6.ç»ˆæ­¢ï¼šè¾“å‡ºæœ€ç»ˆç»“æœ

```
å½“æ²¡æœ‰å¯æ‰§è¡ŒèŠ‚ç‚¹æ—¶ï¼š

ğŸ‘‰ è¿”å›æœ€ç»ˆçŠ¶æ€
ğŸ‘‰ è¾“å‡º AI ç»“æœ
```

å¥½å•¦ï¼Œä½ ç°åœ¨å·²ç»æŒæ¡äº†LangGraphçš„ç²¾é«“~~~

### 6.3.3 å¹¶è¡Œä¸é¡ºåºæ‰§è¡Œ

LangGraphçš„è°ƒåº¦è§„åˆ™æ ¸å¿ƒæ˜¯â€œåŸºäºèŠ‚ç‚¹ä¾èµ–å…³ç³»â€ï¼Œåˆ†ä¸ºé¡ºåºæ‰§è¡Œå’Œå¹¶è¡Œæ‰§è¡Œä¸¤ç§åœºæ™¯ï¼Œå…·ä½“ç”±è¾¹çš„é…ç½®å’ŒèŠ‚ç‚¹ä¾èµ–å†³å®šï¼š

**1. é¡ºåºæ‰§è¡Œ**ï¼šå½“èŠ‚ç‚¹Açš„åç»­èŠ‚ç‚¹åªæœ‰èŠ‚ç‚¹Bï¼Œä¸”èŠ‚ç‚¹Bä¾èµ–èŠ‚ç‚¹Açš„çŠ¶æ€ç»“æœæ—¶ï¼Œè§¦å‘é¡ºåºæ‰§è¡Œâ€”â€”èŠ‚ç‚¹Aæ‰§è¡Œå®Œæˆå¹¶æ›´æ–°çŠ¶æ€åï¼ŒèŠ‚ç‚¹Bæ‰è¢«æ¿€æ´»ï¼Œå³â€œä¸€è¶…æ­¥éª¤ä¸€èŠ‚ç‚¹â€ã€‚

é€‚ç”¨åœºæ™¯ï¼šæ­¥éª¤é—´æœ‰å¼ºä¾èµ–ï¼ˆå¦‚æ‘˜è¦ç”Ÿæˆä¾èµ–å»é‡åçš„æ–‡æœ¬ï¼Œæ•æ„Ÿè¯æ ¡éªŒä¾èµ–æ‘˜è¦ç»“æœï¼‰ï¼Œå‰æ–‡æ¡ˆä¾‹å‡ä¸ºé¡ºåºæ‰§è¡Œåœºæ™¯ã€‚

**2. å¹¶è¡Œæ‰§è¡Œ**ï¼šå½“èŠ‚ç‚¹Açš„åç»­èŠ‚ç‚¹æœ‰å¤šä¸ªï¼ˆå¦‚èŠ‚ç‚¹Bå’ŒèŠ‚ç‚¹Cï¼‰ï¼Œä¸”èŠ‚ç‚¹Bã€Cæ— ç›¸äº’ä¾èµ–ï¼Œä»…ä¾èµ–èŠ‚ç‚¹Açš„çŠ¶æ€ç»“æœæ—¶ï¼Œè§¦å‘å¹¶è¡Œæ‰§è¡Œâ€”â€”èŠ‚ç‚¹Aæ‰§è¡Œå®Œæˆåï¼ŒèŠ‚ç‚¹Bã€Cè¢«åŒæ—¶æ¿€æ´»ï¼Œçº³å…¥åŒä¸€ä¸ªè¶…æ­¥éª¤å¹¶è¡Œæ‰§è¡Œã€‚

é€‚ç”¨åœºæ™¯ï¼šæ­¥éª¤é—´æ— ä¾èµ–ï¼Œæ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªæ–‡ä½“ï¼ŒåŒæ—¶ç”Ÿæˆæ–‡æœ¬çš„æ‘˜è¦å’Œå…³é”®è¯ï¼ˆæ³¨æ„ï¼Œæ‘˜è¦å’Œå…³é”®è¯ä¸€èˆ¬è®¤ä¸ºè¿™2ä¸ªæ˜¯æ²¡æœ‰è”ç³»çš„ï¼‰

```python
from langgraph.graph import StateGraph, START, END
from typing import Optional
from typing import TypedDict, Optional, NotRequired
import time
import random

# ===== 1. å®šä¹‰çŠ¶æ€ï¼ˆå…±äº«é»‘æ¿ï¼‰ =====

class TextProcessState(TypedDict):
    raw_text: str
    summary_text: NotRequired[str]
    keyword_text: NotRequired[str]
    has_sensitive: NotRequired[bool]
    final_text: NotRequired[str]

# ===== 2. å»é‡èŠ‚ç‚¹ï¼ˆå…¥å£èŠ‚ç‚¹ï¼‰ =====
def deduplicate_node(state: TextProcessState):
    print("\nã€èŠ‚ç‚¹ deduplicateã€‘æ‰§è¡Œä¸­...")
    text = state["raw_text"]   # âœ… TypedDict è®¿é—®æ–¹å¼
    time.sleep(1)
    return {"raw_text": text}

# ===== 3. æ‘˜è¦èŠ‚ç‚¹ï¼ˆå¹¶è¡ŒèŠ‚ç‚¹1ï¼‰ =====
def summary_node(state: TextProcessState):
    print("âš¡ å¹¶è¡ŒèŠ‚ç‚¹ summary æ‰§è¡Œä¸­...")
    time.sleep(random.uniform(1, 2))
    summary = "æ‘˜è¦ï¼š" + state["raw_text"][:10]
    return {"summary_text": summary}

# ===== 4. å…³é”®è¯èŠ‚ç‚¹ï¼ˆå¹¶è¡ŒèŠ‚ç‚¹2ï¼‰ =====
def keyword_node(state: TextProcessState):
    print("âš¡ å¹¶è¡ŒèŠ‚ç‚¹ keyword æ‰§è¡Œä¸­...")
    time.sleep(random.uniform(1, 2))
    keywords = "ã€".join(state["raw_text"].split("ï¼Œ")[:3])
    return {"keyword_text": keywords}

# ===== 5. å¹¶è¡Œæ±‡åˆèŠ‚ç‚¹ =====
def sensitive_check_node(state: TextProcessState):
    print("\nã€èŠ‚ç‚¹ sensitive_checkã€‘æ±‡æ€»å¹¶è¡Œç»“æœ")
    print(" summary_text =", state["summary_text"])
    print(" keyword_text =", state["keyword_text"])

    sensitive = "æš´åŠ›" in state["raw_text"]
    return {
        "has_sensitive": sensitive,
        "final_text": f"æœ€ç»ˆè¾“å‡º | æ‘˜è¦={state["summary_text"]} | å…³é”®è¯={state["keyword_text"]}"
    }

# ===== 6. æ„å»º LangGraph =====
builder = StateGraph(TextProcessState)

builder.add_node("deduplicate", deduplicate_node)
builder.add_node("summary", summary_node)
builder.add_node("keyword", keyword_node)
builder.add_node("sensitive_check", sensitive_check_node)

builder.add_edge(START, "deduplicate")

# å¹¶è¡Œåˆ†å‰
builder.add_edge("deduplicate", "summary")
builder.add_edge("deduplicate", "keyword")

# å¹¶è¡Œæ±‡åˆ
builder.add_edge("summary", "sensitive_check")
builder.add_edge("keyword", "sensitive_check")

builder.add_edge("sensitive_check", END)

graph = builder.compile()

# ===== 7. è¿è¡Œ =====
if __name__ == "__main__":
    init_state = TextProcessState(
        raw_text="LangGraphå¾ˆå¼ºå¤§ï¼Œæ”¯æŒçŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒåŠ¨æ€åˆ†æ”¯ï¼Œå¹¶è¡Œæ‰§è¡Œ"
    )

    final_state = graph.invoke(init_state)

    print("\n====== æœ€ç»ˆçŠ¶æ€ ======")
    print(final_state)

```

è¿è¡Œç»“æœ

```
ã€èŠ‚ç‚¹ deduplicateã€‘æ‰§è¡Œä¸­...
âš¡ å¹¶è¡ŒèŠ‚ç‚¹ keyword æ‰§è¡Œä¸­...
âš¡ å¹¶è¡ŒèŠ‚ç‚¹ summary æ‰§è¡Œä¸­...

ã€èŠ‚ç‚¹ sensitive_checkã€‘æ±‡æ€»å¹¶è¡Œç»“æœ
 summary_text = æ‘˜è¦ï¼šLangGraphå¾ˆ
 keyword_text = LangGraphå¾ˆå¼ºå¤§ã€æ”¯æŒçŠ¶æ€ç®¡ç†ã€æ”¯æŒåŠ¨æ€åˆ†æ”¯

====== æœ€ç»ˆçŠ¶æ€ ======
{'raw_text': 'LangGraphå¾ˆå¼ºå¤§ï¼Œæ”¯æŒçŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒåŠ¨æ€åˆ†æ”¯ï¼Œå¹¶è¡Œæ‰§è¡Œ', 'summary_text': 'æ‘˜è¦ï¼šLangGraphå¾ˆ', 'keyword_text': 'LangGraphå¾ˆå¼ºå¤§ã€æ”¯æŒçŠ¶æ€ç®¡ç†ã€æ”¯æŒåŠ¨æ€åˆ†æ”¯', 'has_sensitive': False, 'final_text': 'æœ€ç»ˆè¾“å‡º | æ‘˜è¦=æ‘˜è¦ï¼šLangGraphå¾ˆ | å…³é”®è¯=LangGraphå¾ˆå¼ºå¤§ã€æ”¯æŒçŠ¶æ€ç®¡ç†ã€æ”¯æŒåŠ¨æ€åˆ†æ”¯'}
```

**å­¦ä¹ å°ç»“**ï¼šé¡ºåºæ‰§è¡Œä¾èµ–â€œå•åç»­èŠ‚ç‚¹+å¼ºçŠ¶æ€ä¾èµ–â€ï¼Œå¹¶è¡Œæ‰§è¡Œä¾èµ–â€œå¤šåç»­èŠ‚ç‚¹+æ— ç›¸äº’ä¾èµ–â€ï¼›LangGraphä¼šè‡ªåŠ¨æ ¹æ®èŠ‚ç‚¹ä¾èµ–å’Œè¾¹é…ç½®é€‰æ‹©è°ƒåº¦æ–¹å¼ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®â€œå¹¶è¡Œ/é¡ºåºâ€ï¼Œä¸€èˆ¬è€Œè¨€åªéœ€å…³æ³¨ä¸šåŠ¡é€»è¾‘çš„ä¾èµ–å…³ç³»å³å¯ã€‚

## 6.4 ç»¼åˆå®æ“

æœ¬èŠ‚å°†é€šè¿‡ä¸‰ä¸ªé€’è¿›å¼ç»¼åˆæ¡ˆä¾‹ï¼Œä»ç®€å•åˆ°å¤æ‚æ„å»ºå®Œæ•´å·¥ä½œæµï¼Œè¦†ç›–çº¿æ€§ã€åˆ†æ”¯ã€å¾ªç¯ä¸‰ç§æ ¸å¿ƒåœºæ™¯ï¼Œå¸®åŠ©å¤§å®¶æ•´åˆæ‰€å­¦çŸ¥è¯†ï¼Œå®ç°â€œä»ç†è®ºåˆ°è½åœ°â€çš„è·¨è¶Šã€‚æ‰€æœ‰æ¡ˆä¾‹å‡é‡‡ç”¨LangGraph 1.0+æ¥å£ï¼Œä»£ç å¯ç›´æ¥è¿è¡Œï¼ˆæ›¿æ¢APIå¯†é’¥å³å¯ï¼‰

### 6.4.1 å®æ“å‡†å¤‡ï¼šLangGraphç¯å¢ƒç¡®è®¤ä¸æ ¸å¿ƒAPIå¯¼å…¥

é¦–å…ˆç¡®ä¿ç¯å¢ƒé…ç½®æ­£ç¡®ï¼Œæ ¸å¿ƒä¾èµ–å®‰è£…å®Œæˆï¼ŒåŒæ—¶æ¢³ç†å¸¸ç”¨æ ¸å¿ƒAPIï¼Œæ–¹ä¾¿åç»­æ¡ˆä¾‹è°ƒç”¨ï¼š

**1. ç¯å¢ƒä¾èµ–å®‰è£…**ï¼š

```
pip install langgraph langchain langchain-openai python-dotenv
```

> æ¨èå®‰è£…ç‰ˆæœ¬ â‰¥1.0.0 

**2. æ ¸å¿ƒAPIå¯¼å…¥**

```python
import os
from dotenv import load_dotenv
from langchain_openai import ChatOpenAI

llm = ChatOpenAI(
    api_key=os.getenv("API_KEY"),
    base_url="https://api.deepseek.com",
    model="deepseek-chat",
    temperature=0.3
)

```

### 6.4.2 æ¡ˆä¾‹1ï¼šç®€å•çº¿æ€§å·¥ä½œæµâ€”â€”æ–‡æœ¬å¤„ç†å…¨æµç¨‹ä¸²è”

å­¦ä¹ ç›®æ ‡ï¼šæ•´åˆâ€œçŠ¶æ€ã€èŠ‚ç‚¹ã€è¾¹â€ä¸‰å¤§ç»„ä»¶ï¼Œæ„å»ºâ€œæ–‡æœ¬å»é‡â†’æ‘˜è¦ç”Ÿæˆâ†’æ•æ„Ÿè¯æ ¡éªŒâ†’ç»“æœè¾“å‡ºâ€çš„çº¿æ€§æµç¨‹ï¼ŒæŒæ¡å®Œæ•´å·¥ä½œæµçš„æ­å»ºã€è¿è¡Œä¸ç»“æœæ ¡éªŒæ–¹æ³•ï¼ŒåŒæ—¶ä½“éªŒçŠ¶æ€å¿«ç…§ä¸å¯è§†åŒ–åŠŸèƒ½ã€‚

#### 6.4.2.1 æ¡ˆä¾‹è®¾è®¡æ€è·¯

æµç¨‹é€»è¾‘ï¼šç”¨æˆ·è¾“å…¥åŸå§‹æ–‡æœ¬â†’å…ˆå»é‡æ¸…ç†å†—ä½™å†…å®¹â†’ç”Ÿæˆç®€æ´æ‘˜è¦â†’æ ¡éªŒæ‘˜è¦æ˜¯å¦å«æ•æ„Ÿè¯â†’æ ¼å¼åŒ–è¾“å‡ºç»“æœã€‚å…¨ç¨‹ç”¨å›ºå®šè¾¹ä¸²è”èŠ‚ç‚¹ï¼Œä¾èµ–çŠ¶æ€ä¼ é€’æ•°æ®ï¼Œæœ€ç»ˆé€šè¿‡å¯è§†åŒ–å›¾ç»“æ„å’ŒçŠ¶æ€å†å²ï¼ŒéªŒè¯æµç¨‹æ­£ç¡®æ€§ã€‚

**çŸ¥è¯†ç‚¹ï¼š**çŠ¶æ€å­—æ®µçš„å®Œæ•´è®¾è®¡ã€èŠ‚ç‚¹å‡½æ•°å¤ç”¨ä¸ç»„åˆã€å›ºå®šè¾¹é…ç½®ã€å›¾å¯è§†åŒ–ã€çŠ¶æ€å†å²è¿½æº¯ã€‚

**å®Œæ•´ä»£ç å®ç°**

```python
# ================== åŸºç¡€ä¾èµ– ==================
from typing import TypedDict, NotRequired
from langgraph.graph import StateGraph, START, END
from langchain_core.prompts import PromptTemplate
from langgraph.checkpoint.memory import MemorySaver

# DeepSeek LLMï¼ˆçœŸå®æ¨¡å‹ï¼‰
import os
from dotenv import load_dotenv
from langchain_openai import ChatOpenAI

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# åˆå§‹åŒ–çœŸå® LLM
llm = ChatOpenAI(
    api_key=os.getenv("API_KEY"),
    base_url="https://api.deepseek.com",
    model="deepseek-chat",
    temperature=0.3
)

# ==========================================================
# 1. å®šä¹‰ Stateï¼ˆå·¥ä½œæµå…±äº«çŠ¶æ€ = Agent å†…å­˜ï¼‰
# ==========================================================
class TextProcessState(TypedDict):
    """
    LangGraph çŠ¶æ€å¯¹è±¡ï¼š
    ç”¨äºåœ¨èŠ‚ç‚¹ä¹‹é—´ä¼ é€’æ•°æ®ï¼ˆç±»ä¼¼å…¨å±€å…±äº«å†…å­˜ï¼‰
    """
    raw_text: str                        # è¾“å…¥ï¼šç”¨æˆ·åŸå§‹æ–‡æœ¬
    deduplicated_text: NotRequired[str]  # è¿‡ç¨‹ï¼šå»é‡åçš„æ–‡æœ¬
    summary_text: NotRequired[str]       # è¿‡ç¨‹ï¼šLLM ç”Ÿæˆæ‘˜è¦
    has_sensitive: NotRequired[bool]     # è¿‡ç¨‹ï¼šæ•æ„Ÿè¯æ£€æµ‹ç»“æœ
    final_output: NotRequired[str]       # è¾“å‡ºï¼šæœ€ç»ˆæ ¼å¼åŒ–ç»“æœ


# ==========================================================
# 2. å®šä¹‰èŠ‚ç‚¹å‡½æ•°ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ = ä¸€ä¸ªå¤„ç†æ¨¡å—ï¼‰
# ==========================================================
def deduplicate_node(state: TextProcessState) -> TextProcessState:
    """æ–‡æœ¬å»é‡èŠ‚ç‚¹"""
    raw_text = state["raw_text"]
    lines = raw_text.split("\n")
    unique_lines = []
    seen = set()
    for line in lines:
        line_stripped = line.strip()
        if line_stripped and line_stripped not in seen:
            seen.add(line_stripped)
            unique_lines.append(line)
    print("âœ… å»é‡èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ")
    return {"deduplicated_text": "\n".join(unique_lines)}

def summary_node(state: TextProcessState) -> TextProcessState:
    """æ‘˜è¦ç”ŸæˆèŠ‚ç‚¹ï¼ˆè°ƒç”¨LLMï¼‰"""
    deduplicated_text = state["deduplicated_text"]
    prompt = PromptTemplate(
        input_variables=["text"],
        template="è¯·ä¸ºä»¥ä¸‹æ–‡æœ¬ç”Ÿæˆ50å­—ä»¥å†…çš„ç®€æ´æ‘˜è¦ï¼Œä¿ç•™æ ¸å¿ƒä¿¡æ¯ï¼š\n{text}"
    )
    chain = prompt | llm
    summary = chain.invoke({"text": deduplicated_text}).content
    print("ğŸ¤– æ‘˜è¦èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ")
    return {"summary_text": summary}

def sensitive_check_node(state: TextProcessState) -> TextProcessState:
    """æ•æ„Ÿè¯æ£€æµ‹èŠ‚ç‚¹"""
    summary = state["summary_text"]
    sensitive_words = ["æ•æ„Ÿè¯1", "æ•æ„Ÿè¯2", "è¿æ³•", "è¿è§„"]
    has_sensitive = any(word in summary for word in sensitive_words)
    print("ğŸ” æ•æ„Ÿè¯æ£€æµ‹å®Œæˆï¼š", has_sensitive)
    return {"has_sensitive": has_sensitive}

def output_node(state: TextProcessState) -> TextProcessState:
    """è¾“å‡ºèŠ‚ç‚¹ï¼ˆæ ¹æ®æ•æ„Ÿè¯ç»“æœæ ¼å¼åŒ–ï¼‰"""
    summary = state["summary_text"]
    has_sensitive = state["has_sensitive"]
    if has_sensitive:
        final_output = "âš ï¸ æ£€æµ‹åˆ°æ•æ„Ÿå†…å®¹ï¼Œæ— æ³•è¾“å‡ºæ‘˜è¦"
    else:
        final_output = f"""âœ… æ–‡æœ¬å¤„ç†å®Œæˆ
ã€æ‘˜è¦ã€‘
{summary}

ã€å»é‡ååŸæ–‡ã€‘
{state['deduplicated_text']}
"""
    print("ğŸ“¤ è¾“å‡ºèŠ‚ç‚¹æ‰§è¡Œå®Œæˆ")
    return {"final_output": final_output}


# ==========================================================
# 3. æ„å»ºçº¿æ€§å·¥ä½œæµå›¾ï¼ˆå›ºå®šè¾¹ï¼‰
# ==========================================================
def build_linear_graph():
    """æ„å»ºçº¿æ€§ LangGraph å·¥ä½œæµï¼Œ**å®é™…å¯ç”¨çŠ¶æ€å†å²**"""
    graph_builder = StateGraph(TextProcessState)

    # æ³¨å†ŒèŠ‚ç‚¹
    graph_builder.add_node("deduplicate", deduplicate_node)
    graph_builder.add_node("summary", summary_node)
    graph_builder.add_node("sensitive_check", sensitive_check_node)
    graph_builder.add_node("output", output_node)

    # é…ç½®å›ºå®šè¾¹ï¼ˆçº¿æ€§æ‰§è¡Œï¼‰
    graph_builder.add_edge(START, "deduplicate")
    graph_builder.add_edge("deduplicate", "summary")
    graph_builder.add_edge("summary", "sensitive_check")
    graph_builder.add_edge("sensitive_check", "output")
    graph_builder.add_edge("output", END)

    # ã€ä¿®æ”¹æ ¸å¿ƒã€‘ç¼–è¯‘æ—¶ä¼ å…¥MemorySaverï¼ŒçœŸæ­£å¯ç”¨çŠ¶æ€å†å²
    # MemorySaverï¼šå†…å­˜çº§æ£€æŸ¥ç‚¹ï¼Œé€‚åˆæµ‹è¯•/å¼€å‘ï¼Œé‡å¯ç¨‹åºåçŠ¶æ€ä¸¢å¤±
    return graph_builder.compile(checkpointer=MemorySaver())


# ==========================================================
# 4. æµ‹è¯•è¿è¡Œï¼ˆget_state_history å¯æ­£å¸¸ä½¿ç”¨ï¼‰
# ==========================================================
if __name__ == "__main__":

    # æ„å»ºå›¾
    linear_graph = build_linear_graph()

    # åˆå§‹çŠ¶æ€ï¼ˆè¾“å…¥æ•°æ®ï¼‰
    test_state: TextProcessState = {
        "raw_text": "LangGraphæ˜¯LangChainç”Ÿæ€çš„å·¥ä½œæµæ¡†æ¶\nLangGraphæ”¯æŒçŠ¶æ€ç®¡ç†\nLangGraphæ˜¯LangChainç”Ÿæ€çš„å·¥ä½œæµæ¡†æ¶\næ”¯æŒåŠ¨æ€åˆ†æ”¯å’Œå¹¶è¡Œæ‰§è¡Œ"
    }

    # thread_idï¼šä¼šè¯å”¯ä¸€æ ‡è¯†ï¼Œæµ‹è¯•ç”¨éšä¾¿å‘½åï¼Œå¤šä¼šè¯ç”¨ä¸åŒidå³å¯
    config = {"configurable": {"thread_id": "text_process_test_001"}}

    # ========== å…³é”®ä¿®æ”¹2ï¼šinvokeæ—¶ä¼ å…¥config ==========
    final_state = linear_graph.invoke(test_state, config=config)

    # è¾“å‡ºæœ€ç»ˆç»“æœ
    print("\n" + "=" * 50)
    print(final_state["final_output"])

    # ========== å…³é”®ä¿®æ”¹3ï¼šget_state_historyæ—¶ä¹Ÿä¼ å…¥åŒä¸€ä¸ªconfig ==========
    print("\n" + "=" * 50)
    history = list(linear_graph.get_state_history(config))   # å¿…é¡»ä¼ config
    print("çŠ¶æ€å¿«ç…§æ•°é‡ï¼ˆè¶…æ­¥éª¤ï¼‰ï¼š", len(history))

    for i, state in enumerate(history, 1):
        print(f"\nç¬¬{i}æ­¥ï¼š")
        print("state", state)
    
```

è¿è¡Œç»“æœ

```
 å»é‡èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ
ğŸ¤– æ‘˜è¦èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ
ğŸ” æ•æ„Ÿè¯æ£€æµ‹å®Œæˆï¼š False
ğŸ“¤ è¾“å‡ºèŠ‚ç‚¹æ‰§è¡Œå®Œæˆ

==================================================
âœ… æ–‡æœ¬å¤„ç†å®Œæˆ
ã€æ‘˜è¦ã€‘
LangGraphæ˜¯LangChainç”Ÿæ€çš„å·¥ä½œæµæ¡†æ¶ï¼Œæ”¯æŒçŠ¶æ€ç®¡ç†ã€åŠ¨æ€åˆ†æ”¯ä¸å¹¶è¡Œæ‰§è¡Œã€‚

ã€å»é‡ååŸæ–‡ã€‘
LangGraphæ˜¯LangChainç”Ÿæ€çš„å·¥ä½œæµæ¡†æ¶
LangGraphæ”¯æŒçŠ¶æ€ç®¡ç†
æ”¯æŒåŠ¨æ€åˆ†æ”¯å’Œå¹¶è¡Œæ‰§è¡Œ


==================================================
çŠ¶æ€å¿«ç…§æ•°é‡ï¼ˆè¶…æ­¥éª¤ï¼‰ï¼š 6

ç¬¬1æ­¥ï¼š
state StateSnapshot(values={...
```

ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹å›¾çš„æ‰§è¡ŒçŠ¶æ€

```python
png_data = linear_graph.get_graph().draw_mermaid_png()  # è·å–PNGå­—èŠ‚æµ
    with open("linear_text_process_graph.png", "wb") as file:  # wb=äºŒè¿›åˆ¶å†™å…¥
        file.write(png_data)
    print("ğŸ“Š å·¥ä½œæµå¯è§†åŒ–å›¾å·²ä¿å­˜ï¼šlinear_text_process_graph.png\n")
```

![6-5](..\src\img\6-5.png)

### 6.4.3 æ¡ˆä¾‹2ï¼šåˆ†æ”¯å·¥ä½œæµâ€”â€”å¸¦ç»“æœæ ¡éªŒçš„åŠ¨æ€æ–‡æœ¬å¤„ç†

æœ¬æ¡ˆä¾‹ç›®æ ‡ï¼šåœ¨æ¡ˆä¾‹1åŸºç¡€ä¸Šï¼Œæ–°å¢â€œæ‘˜è¦è´¨é‡æ ¡éªŒâ€åˆ†æ”¯é€»è¾‘ï¼Œå®ç°â€œè´¨é‡åˆæ ¼â†’è¾“å‡ºç»“æœâ€â€œè´¨é‡ä¸åˆæ ¼â†’å›é€€é‡ç”Ÿæˆâ€çš„åŠ¨æ€æµè½¬ï¼ŒæŒæ¡æ¡ä»¶è¾¹é…ç½®ã€åˆ†æ”¯èŠ‚ç‚¹è®¾è®¡ä¸çŠ¶æ€ä¾èµ–å¤„ç†ã€‚

#### 6.4.2.1 æ¡ˆä¾‹è®¾è®¡æ€è·¯

æµç¨‹é€»è¾‘ï¼šæ–‡æœ¬å»é‡â†’ç”Ÿæˆæ‘˜è¦â†’æ•æ„Ÿè¯æ ¡éªŒï¼ˆè¿‡æ»¤é£é™©ï¼‰â†’æ‘˜è¦è´¨é‡æ ¡éªŒï¼ˆåˆ¤æ–­æ˜¯å¦ç¬¦åˆé•¿åº¦ã€ä¿¡æ¯å®Œæ•´æ€§ï¼‰â†’è´¨é‡åˆæ ¼åˆ™è¾“å‡ºï¼Œä¸åˆæ ¼åˆ™å›é€€åˆ°æ‘˜è¦ç”ŸæˆèŠ‚ç‚¹é‡ç”Ÿæˆï¼ˆé™åˆ¶é‡ç”Ÿæˆæ¬¡æ•°ï¼Œé¿å…æ— é™å¾ªç¯ï¼‰ã€‚

**çŸ¥è¯†ç‚¹ï¼š**æ¡ä»¶è¾¹å¤šåˆ†æ”¯é…ç½®ã€å¾ªç¯é€»è¾‘è®¾è®¡ã€çŠ¶æ€å­—æ®µæ‰©å±•ï¼ˆè®°å½•é‡ç”Ÿæˆæ¬¡æ•°ï¼‰ã€å¾ªç¯ç»ˆæ­¢æ¡ä»¶æ§åˆ¶ã€‚

